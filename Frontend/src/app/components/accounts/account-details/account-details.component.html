<div class="account-changes">
  <mat-card *ngIf="account">
    <mat-card-content class="card">
      <h3>View Account Details</h3>
      <div>
        <div class="key-value">
          <label><b>Account Number:</b> {{ account.accountNumber }}</label>
        </div>
        <div class="key-value">
          <label><b>Owner:</b> {{ account.owner }}</label>
        </div>
        <div class="key-value">
          <label><b>Currency:</b> {{ account.currency }}</label>
        </div>
        <div class="key-value">
          <label><b>Name:</b> {{ account.name }}</label>
        </div>
        <div class="key-value">
          <label
            ><b>Transaction limit:</b> {{ account.transactionLimit }}</label
          >
        </div>
        <div class="key-value">
          <label><b>Status:</b> {{ account.status }}</label>
        </div>
        <div class="key-value">
          <label><b>Account Status:</b> {{ account.accountLockStatus }}</label>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- TODO: make invisible if entity is not pending OR if current user does not have rights -->
  <mat-card *ngIf="pendingAccount.accountNumber">
    <mat-card-content class="card">
      <h3>View Pending Account Details</h3>
      <div>
        <div class="key-value">
          <label
            ><b>Account Number:</b> {{ pendingAccount.accountNumber }}</label
          >
        </div>
        <div class="key-value">
          <label><b>Owner:</b> {{ pendingAccount.ownerUserName }}</label>
        </div>
        <div class="key-value">
          <label><b>Currency:</b> {{ pendingAccount.currency }}</label>
        </div>
        <div class="key-value">
          <label><b>Name:</b> {{ pendingAccount.name }}</label>
        </div>
        <div class="key-value">
          <label
            ><b>Transaction limit:</b>
            {{ pendingAccount.transactionLimit }}</label
          >
        </div>
        <div class="key-value">
          <label><b>Status:</b> {{ pendingAccount.status }}</label>
        </div>
        <div class="key-value">
          <label
            ><b>Account Status:</b>
            {{ pendingAccount.accountLockStatus }}</label
          >
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<div class="actions">
  <label>Actions:</label>
  <button
    *ngIf="isAllowed(EOperationType.BLOCK)"
    mat-button
    color="primary"
    (click)="blockAccount(accountNumber)"
  >
    Block
  </button>
  <button
    *ngIf="isAllowed(EOperationType.UNBLOCK)"
    mat-button
    color="primary"
    (click)="unblockAccount(accountNumber)"
  >
    Unblock
  </button>
  <button
    *ngIf="isAllowed(EOperationType.BLOCK_CREDIT)"
    mat-button
    color="primary"
    (click)="blockCreditAccount(accountNumber)"
  >
    Block credit
  </button>
  <button
    *ngIf="isAllowed(EOperationType.UNBLOCK_CREDIT)"
    mat-button
    color="primary"
    (click)="unblockCreditAccount(accountNumber)"
  >
    Unblock credit
  </button>
  <button
    *ngIf="isAllowed(EOperationType.BLOCK_DEBIT)"
    mat-button
    color="primary"
    (click)="blockDebitAccount(accountNumber)"
  >
    Block debit
  </button>
  <button
    *ngIf="isAllowed(EOperationType.UNBLOCK_DEBIT)"
    mat-button
    color="primary"
    (click)="unblockDebitAccount(accountNumber)"
  >
    Unblock debit
  </button>

  <button
    *ngIf="isAllowed(EOperationType.REPAIR) && account.status === 'IN_REPAIR'"
    mat-button
    color="primary"
    (click)="repairAccount(accountNumber)"
  >
    Repair
  </button>

  <button
    *ngIf="isAllowed(EOperationType.APPROVE)"
    mat-button
    color="primary"
    (click)="approveChanges(accountNumber)"
  >
    Approve
  </button>
  <button
    *ngIf="isAllowed(EOperationType.REJECT)"
    mat-button
    color="warn"
    (click)="rejectChanges(accountNumber)"
  >
    Reject
  </button>
  <button mat-button (click)="onCancel()">Go back</button>
</div>

<div class="account-history">
  <h2>Account History</h2>
  <table
    mat-table
    class="table"
    [dataSource]="accountHistoryDataSource"
    matSort
  >
    <ng-container matColumnDef="accountNumber">
      <th mat-header-cell *matHeaderCellDef>Account number</th>
      <td mat-cell *matCellDef="let entry">{{ entry.accountNumber }}</td>
    </ng-container>
    <ng-container matColumnDef="owner">
      <th mat-header-cell *matHeaderCellDef>Owner</th>
      <td mat-cell *matCellDef="let entry">{{ entry.owner }}</td>
    </ng-container>
    <ng-container matColumnDef="currency">
      <th mat-header-cell *matHeaderCellDef>Currency</th>
      <td mat-cell *matCellDef="let entry">{{ entry.currency }}</td>
    </ng-container>
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let entry">{{ entry.name }}</td>
    </ng-container>
    <ng-container matColumnDef="transactionLimit">
      <th mat-header-cell *matHeaderCellDef>Transaction limit</th>
      <td mat-cell *matCellDef="let entry">{{ entry.transactionLimit }}</td>
    </ng-container>
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Profile Status</th>
      <td mat-cell *matCellDef="let entry">{{ entry.status }}</td>
    </ng-container>
    <ng-container matColumnDef="accountLockStatus">
      <th mat-header-cell *matHeaderCellDef>Account Status</th>
      <td mat-cell *matCellDef="let entry">{{ entry.accountLockStatus }}</td>
    </ng-container>
    <ng-container matColumnDef="timestamp">
      <th mat-header-cell *matHeaderCellDef>Timestamp</th>
      <td mat-cell *matCellDef="let entry">
        {{ formatTimestamp(entry.timestamp) }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnsHistory"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnsHistory"></tr>
  </table>
  <mat-paginator
    #accountHistoryPaginator
    [pageSizeOptions]="[5, 10, 25]"
    showFirstLastButtons
  ></mat-paginator>
</div>

<div class="account-audit">
  <h2>Account Audit</h2>
  <table mat-table class="table" [dataSource]="accountAuditDataSource" matSort>
    <ng-container matColumnDef="userName">
      <th mat-header-cell *matHeaderCellDef>Username</th>
      <td mat-cell *matCellDef="let entry">{{ entry.username }}</td>
    </ng-container>
    <ng-container matColumnDef="executedOperation">
      <th mat-header-cell *matHeaderCellDef>Executed operation</th>
      <td mat-cell *matCellDef="let entry">{{ entry.operation.operation }}</td>
    </ng-container>
    <ng-container matColumnDef="classProfileName">
      <th mat-header-cell *matHeaderCellDef>Class name</th>
      <td mat-cell *matCellDef="let entry">
        {{ entry.operation.groupName }}
      </td>
    </ng-container>
    <ng-container matColumnDef="timestamp">
      <th mat-header-cell *matHeaderCellDef>Timestamp</th>
      <td mat-cell *matCellDef="let entry">
        {{ formatTimestamp(entry.timestamp) }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnsAudit"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnsAudit"></tr>
  </table>
  <mat-paginator
    #accountAuditPaginator
    [pageSizeOptions]="[5, 10, 25]"
    showFirstLastButtons
  ></mat-paginator>
</div>
