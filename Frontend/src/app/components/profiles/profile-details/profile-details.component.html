<div class="profile-changes">
  <mat-card>
    <mat-card-content class="card">
      <h3>View Profile Details</h3>
      <div>
        <div class="key-value">
          <label> <b>Type:</b> {{ profile.type }} </label>
        </div>
        <div class="key-value">
          <label> <b>Name:</b> {{ profile.name }} </label>
        </div>
        <div class="key-value">
          <label> <b>Status:</b> {{ profile.status }} </label>
        </div>
        <div class="key-value">
          <label><b>Rights:</b></label>
          <ul>
            <li *ngFor="let operation of profile?.rights">
              Operation: {{ operation.operation }}; Class Name:
              {{ operation.groupName }}
            </li>
          </ul>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- TODO: make invisible if entity is not pending OR if current user does not have rights -->
  <mat-card *ngIf="pendingProfile.type">
    <mat-card-content class="card">
      <h3>View Pending Profile Details</h3>
      <div>
        <div class="key-value">
          <label> <b>Type:</b> {{ pendingProfile.type }} </label>
        </div>
        <div class="key-value">
          <label> <b>Name:</b> {{ profile.name }} </label>
        </div>
        <div class="key-value">
          <label> <b>Status:</b> {{ pendingProfile.status }} </label>
        </div>
        <div class="key-value">
          <label><b>Rights:</b></label>
          <ul>
            <li *ngFor="let operation of pendingProfile.rights">
              Operation:{{ operation.operation }}; Class Name:
              {{ operation.groupName }}
            </li>
          </ul>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
</div>

<div class="actions">
  <label>Actions:</label>
  <!-- Add buttons for Approve and Reject actions -->
  <button
    [disabled]="
      !(isAllowed(EOperationType.REPAIR) && profile.status === 'IN_REPAIR')
    "
    mat-button
    color="primary"
    (click)="repairProfile(name)"
  >
    Repair
  </button>
  <button
    *ngIf="isAllowed(EOperationType.APPROVE)"
    mat-button
    color="primary"
    (click)="approveChanges(name)"
  >
    Approve
  </button>
  <button
    *ngIf="isAllowed(EOperationType.REJECT)"
    mat-button
    color="warn"
    (click)="rejectChanges(name)"
  >
    Reject
  </button>
  <button mat-button (click)="onCancel()">Go back</button>
</div>

<div class="profile-history">
  <h2>Profile History</h2>
  <table
    mat-table
    class="table"
    [dataSource]="profileHistoryDataSource"
    matSort
  >
    <ng-container matColumnDef="type">
      <th mat-header-cell *matHeaderCellDef>Profile type</th>
      <td mat-cell *matCellDef="let entry">{{ entry.type }}</td>
    </ng-container>
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let entry">{{ entry.name }}</td>
    </ng-container>
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Profile Status</th>
      <td mat-cell *matCellDef="let entry">{{ entry.status }}</td>
    </ng-container>
    <ng-container matColumnDef="historyEntryStatus">
      <th mat-header-cell *matHeaderCellDef>History Entry Status</th>
      <td mat-cell *matCellDef="let entry">{{ entry.status }}</td>
    </ng-container>
    <ng-container matColumnDef="timestamp">
      <th mat-header-cell *matHeaderCellDef>Timestamp</th>
      <td mat-cell *matCellDef="let entry">
        {{ formatTimestamp(entry.timestamp) }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnsHistory"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnsHistory"></tr>
  </table>
  <mat-paginator
    #profileHistoryPaginator
    [pageSizeOptions]="[5, 10, 25]"
    showFirstLastButtons
  ></mat-paginator>
</div>

<div class="profile-audit">
  <h2>Profile Audit</h2>
  <table mat-table class="table" [dataSource]="profileAuditDataSource" matSort>
    <ng-container matColumnDef="userName">
      <th mat-header-cell *matHeaderCellDef>Username</th>
      <td mat-cell *matCellDef="let entry">{{ entry.username }}</td>
    </ng-container>
    <ng-container matColumnDef="executedOperation">
      <th mat-header-cell *matHeaderCellDef>Executed operation</th>
      <td mat-cell *matCellDef="let entry">
        {{ entry.operation.operation }}
      </td>
    </ng-container>
    <ng-container matColumnDef="classProfileName">
      <th mat-header-cell *matHeaderCellDef>Class name</th>
      <td mat-cell *matCellDef="let entry">
        {{ entry.operation.groupName }}
      </td>
    </ng-container>
    <ng-container matColumnDef="timestamp">
      <th mat-header-cell *matHeaderCellDef>Timestamp</th>
      <td mat-cell *matCellDef="let entry">
        {{ formatTimestamp(entry.timestamp) }}
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumnsAudit"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumnsAudit"></tr>
  </table>
  <mat-paginator
    #profileAuditPaginator
    [pageSizeOptions]="[5, 10, 25]"
    showFirstLastButtons
  ></mat-paginator>
</div>
